<% title "RBlog â€’ " + @post.title %>
<% content_menu(:current_selected => "posts") %>
<div class="b-post__category g-light_gray"><%= @post.category.title %></div>
<div class="b-post__publish_date g-light_gray">
  <%= @post.created_at.strftime("%d, %B %Y, %H:%M") %>
</div>
<h2 class="g-light_gray"><%= @post.title %></h2>

<%# Editing of post only allowed to registered users and only if current_user == @post.author %>
<% if can? :edit, @post %>
    <%= link_to "Edit this #{@post.content.class.to_s.downcase}", edit_post_path(@post.id), :class => "b-post-edit_link g-link-no-visited" %>
<% end %>
<div class="b-post-content g-indent">
  <%= render :partial => "posts/#{@post.content.class.to_s.downcase.pluralize}/show", :locals => {:content => @post.content} %>
</div>

<%= render :partial => "posts/post_details", :locals => { :post => @post, :options => {:no_comments_count => true}} %>

<div class="b-post__comments">
  <a name="comments"></a>

  <h2 class="g-light_gray">Comments (<%= @post.comments_count %>)</h2>
  <%# cache (:controller => "posts", :action => "show", :id => @post.id) do %>
  <ul id="comment_0_children" class="b-post__comments_list">
    <%= render :partial => "comments/show", :collection => @post.comments.select { |comment| comment.parent_comment_id == 0
    }, :as => :comment %>
  </ul>
  <%# end %>

  <div id="add_comment">
    <% if can? :create, Comment %>
        <h3>
          <%= link_to_remote 'Add comment', {:url => { :controller => "comments", :action => "new", :post_id => @post.id,
                                                       :parent_comment_id => 0}, :method => "get", }, :href => new_post_comment_url(@post, :anchor => "new_comment") %>
        </h3>
        <%= render :partial => "comments/form" %>
    <% else %>
        You cannot create comments right now, try to login first.
    <% end %>
  </div>

</div>
